{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Выученные слова</h2>

    <div class="row g-3">
        {% for item in known_words %}
        <div class="col-6 col-md-4 col-lg-3">
            <div class="card p-3">
                <div class="d-flex justify-content-between align-items-center">
                    <span class="word-name">{{ item.word.name }}</span>

                    <!-- Галочка -->
                    <button class="btn btn-sm btn-outline-success known-toggle"
                            data-word-id="{{ item.word.id }}">
                        <i class="bi bi-check-lg"></i>
                    </button>
                </div>
            </div>
        </div>
        {% empty %}
        <p class="text-muted">Список пуст</p>
        {% endfor %}
    </div>
</div>
<script>
document.querySelectorAll(".known-toggle").forEach(btn => {
    btn.addEventListener("click", async () => {
        const wordId = btn.dataset.wordId;
        const csrftoken = getCookie("csrftoken");

        const res = await fetch("{% url 'toggle_known_word' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": csrftoken
            },
            body: new FormData(Object.assign(new FormData(), { word_id: wordId }))
        });

        const data = await res.json();
        if (data.status === "removed") {
            btn.closest(".card").remove();
        }
    });
});

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>

{% endblock %}
